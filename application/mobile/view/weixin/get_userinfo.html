<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>列表页</title>
    <link rel="stylesheet" href="__STATIC__/css/global.css">
    <link rel="stylesheet" href="__STATIC__/css/pkbang.css">
    <style type="text/css">
        .overHiden{
          overflow: hidden;
          height: 100%;
        }
    </style>
</head>
<body class="pk-bg">

    <div class="search-wrapper">
            <i class="icon5 user-btn"></i>
            <div class="input-wrapper">
                <i class="icon5 search-icon"></i>
                <input id="search" type="text" value="请输入用户名" onfocus="if(this.value=='请输入用户名'){this.value=''}" onblur="if(this.value==''){this.value='请输入用户名'}">
                <input class="search-btn" type="submit" value="搜索">
            </div>
        </div>
        <ul id="userList">
            <li class="item">
                <div class="left">
                    <div class="number">1</div>
                    <div class="poster">
                        <img src="__STATIC__/image/poster1.png" alt="">
                    </div>
                </div>
                <div class="right">
                    <div>
                        <div class="user-name">晴天还是雨天</div>
                        <span>北京六小</span>
                    </div>
                    <div>北京市朝阳区</div>
                </div>
                <div class="pk">PK</div>
            </li>
        </ul>
    
        <div class="dangqian">
            <div class="poster">
                <img src="__STATIC__/image/poster1.png" alt="">
            </div>
            <p>当前排名<span>1/100</span></p>
        </div>
        <div class="tanchutn-wrapper"> 
                        <div class="tanchuang">
                        <div class="poster">
                        <img src="__STATIC__/image/touxiang.png" alt="">
                        </div>
                        <div>
                        <span class="user2-name">123456</span> <span class="location">123</span>
                        </div>
                        <div style="color: rgb(85, 79, 202);font-size: 0.4rem">邀请你加入游戏~~</div>
                        <div style="display:flex;justify-content: center;margin-top: 0.5rem">
                        <div style="color: rgb(85, 79, 202);font-size: 0.4rem;display:flex;align-items: center">
                        <i class="icon2 icon-jinbi"></i> +10
                        </div>
                        <div style="color: rgb(85, 79, 202);margin-left: 0.3rem ;font-size: 0.4rem;display:flex;align-items: center">
                        <i class="icon2 icon-jingyan"></i> +10
                        </div>
                        </div>
                        <i class="icon5" style="width:100%;display:inline-block;height:0.04rem;margin: 0 auto;background-position: -2.5rem -3.6rem"></i>
                        <div class="btn">
                        <div class="back">拒绝</div>
                        <div class="agreen">同意</div>
                        </div>
                        </div>
                        </div>
    <script src="__STATIC__/js/rem.js"></script>
    <script src="__STATIC__/js/jquery.js"></script>   
    <script>
         var userinfo = {$userinfo};
            console.log(userinfo)
            localStorage["mUserInfo"] = JSON.stringify(userinfo);
            localStorage.setItem("mUserInfo", JSON.stringify(userinfo));
        var ws = new WebSocket("ws://120.92.10.2:2345")
        ws.onopen=function(){
            ws.send("youaremybaby")
        }
        ws.onmessage = function (evt) { 
            console.log("onmessage")
            console.log(evt.data)
            console.log(typeof(evt.data))
            // let messageData=JSON.parse(evt.data)
            var client_id = evt.data;
            console.log(client_id )
            var data={
                user_id:userinfo.user_id,
                client_id:client_id      
              }
            console.log(data)
            $.ajax({
              type: 'POST',
              url: "http://tounao.staraise.com.cn/Api/common/bindUid",
              data: data,
              dataType: "json",
              success: function(res){
                console.log("绑定成功")
              },
              error: function(e) {
                    console.log("error");
               }
            })
            $(".tanchutn-wrapper").css("display","block")
            console.log($(".tanchutn-wrapper").css("display"))
            document.addEventListener("touchmove",function(e){
                if($(".tanchutn-wrapper").css("display")=='block'){
                   $("html,body").addClass("overHiden")
                }
            },false)
            // if($(".tanchutn-wrapper").css("display")=='block'){
            //     $("html,body").addClass("overHiden")
            // }
            //接受邀请
            // if(messageData.action=='invite'){
            //     $(".tanchutn-wrapper").css("display","block")
            // }
        };
    </script>
    <script type="text/javascript">
        $(document).ready(function(){
            $.ajax({
              type: 'POST',
              url: "http://tounao.staraise.com.cn/Api/index/index",
              data: {page:1},
              dataType: "json",
              success: function(res){
                console.log("res")
                console.log(res)
                res.data.forEach(function(item){
                   $("#userList").append(`
                        <li class="item">
                            <div class="left">
                                <div class="number">1</div>
                                <div class="poster">
                                    <img src="${item.head_pic}" alt="">
                                </div>
                            </div>
                            <div class="right">
                                <div>
                                    <div class="user-name">${item.nickname}</div>
                                    <span>北京六小</span>
                                </div>
                                <div>${item.province_city}</div>
                            </div>
                            <div class="pk" data-id="${item.user_id}">PK</div>
                        </li>
                    `) 
                })
              
                 //点击pk
                $(".pk").click(function() {
                    $(".tanchutn-wrapper").css("display","block")
                    let  user_id = {$userinfo}.user_id
                    //邀请接口
                    $.ajax({
                      type: 'POST',
                      url: "http://tounao.staraise.com.cn/Api/pk/invite",
                      data: {
                        user_id:user_id,
                        to_user_id:$(this).data("id")
                      },
                      dataType: "json",
                      success:function(){

                      }
                    })
                })
                //接受邀请
                $(".agreen").click(function(){
                   alert()
                   window.location.href="../pk/index.html?id=123" 
                })
                $(".back").click(function(){
                    $(".tanchutn-wrapper").hide()
                })
               
              },
              error: function(e) {
                    console.log("error");
               }
            })
        })
    </script>    
</body>
</html>